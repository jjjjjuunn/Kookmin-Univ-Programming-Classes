# 후위 표기법 변환 완전 정복 🚀

## 📌 시험 출제 포인트
- **중위 표기법 → 후위 표기법 변환** (손으로 변환 + 코드 구현)
- **후위 표기법 계산**
- **스택을 이용한 연산자 우선순위 처리**

---

## 🎯 핵심 개념

### 표기법 종류
| 표기법 | 예시 | 특징 |
|--------|------|------|
| **중위(Infix)** | `3 + 2 * 4` | 우리가 쓰는 일반적인 수식 |
| **후위(Postfix)** | `3 2 4 * +` | 연산자가 피연산자 뒤에 |
| **전위(Prefix)** | `+ 3 * 2 4` | 연산자가 피연산자 앞에 |

### 후위 표기법의 장점
- ✅ 괄호 불필요
- ✅ 연산자 우선순위 자동 처리
- ✅ 스택으로 쉽게 계산

---

## 📝 알고리즘 핵심 규칙

### 1. 연산자 우선순위
```python
precedence('(') = 0  # 괄호는 가장 낮음
precedence('+') = 1
precedence('-') = 1
precedence('*') = 2
precedence('/') = 2
```

### 2. 변환 규칙
```
1. 숫자(피연산자) → 바로 출력
2. 여는 괄호 '(' → 스택에 push
3. 닫는 괄호 ')' → '('를 만날 때까지 pop & 출력
4. 연산자 → 스택에서 우선순위 높거나 같은 것들 pop & 출력 후 push
5. 끝 → 스택에 남은 것 모두 출력
```

---

## 💻 코드 구현

### 기본 함수들
```python
def isOperator(op: str) -> bool:
    return op == '+' or op == '-' or op == '*' or op == '/'

def precedence(op: str) -> int:
    if op == '(':
        return 0
    elif op == '+' or op == '-':
        return 1
    elif op == '*' or op == '/':
        return 2
    else:
        return 3
```

### 중위 → 후위 변환 (핵심!)
```python
def InfixToPostfix(infix: str) -> list:
    s = []  # 연산자 스택
    
    # 공백으로 토큰 분리
    infix = infix.replace('(', ' ( ')
    infix = infix.replace(')', ' ) ')
    infix = infix.replace('+', ' + ')
    infix = infix.replace('-', ' - ')
    infix = infix.replace('*', ' * ')
    infix = infix.replace('/', ' / ')
    infix = infix.split()
    
    postfix = []
    
    for ch in infix:
        # 1. 여는 괄호
        if ch == '(':
            s.append(ch)
        
        # 2. 닫는 괄호
        elif ch == ')':
            while s and s[-1] != '(':
                postfix.append(s[-1])
                s.pop()
            if s:
                s.pop()  # '(' 제거
        
        # 3. 연산자 (핵심!)
        elif isOperator(ch):
            # 스택에서 우선순위 높거나 같은 것들 먼저 출력
            while s and precedence(s[-1]) >= precedence(ch):
                postfix.append(s[-1])
                s.pop()
            s.append(ch)  # 현재 연산자 push
        
        # 4. 숫자
        elif str.isdigit(ch):
            postfix.append(ch)
    
    # 5. 스택에 남은 연산자 모두 출력
    while s:
        postfix.append(s[-1])
        s.pop()
    
    return postfix
```

### 후위 표기법 계산
```python
def evalPostfix(postfix: list) -> int:
    s = []
    
    for ch in postfix:
        if str.isdigit(ch):
            s.append(int(ch))
        
        elif isOperator(ch):
            if len(s) < 2:
                return None
            
            op2 = s.pop()  # 두 번째 피연산자
            op1 = s.pop()  # 첫 번째 피연산자
            
            if ch == '+':
                s.append(op1 + op2)
            elif ch == '-':
                s.append(op1 - op2)
            elif ch == '*':
                s.append(op1 * op2)
            elif ch == '/':
                s.append(op1 // op2)
    
    return s[-1] if s else None
```

---

## 🔍 핵심 부분 상세 설명

### 연산자 처리 로직 (가장 중요!)
```python
elif isOperator(ch):
    while len(s) and precedence(s[-1]) >= precedence(ch):
        postfix.append(s[-1])
        s.pop()
    s.append(ch)
```

**의미:**
1. `len(s)`: 스택이 비어있지 않은지 확인
2. `precedence(s[-1]) >= precedence(ch)`: 스택 맨 위가 현재보다 우선순위 높거나 같은지
3. **True면**: 스택 맨 위를 먼저 출력 (먼저 계산되어야 함)
4. **False면**: 현재 연산자를 스택에 push

**왜 `>=` 인가?**
- 같은 우선순위도 **왼쪽부터 계산**하기 위해
- 예: `2 + 3 - 4` → `2 3 + 4 -` (+ 먼저 출력)

---

## 📚 손으로 변환 연습

### 예제 1: `2 + 3 * 4`

| 토큰 | postfix | stack | 설명 |
|------|---------|-------|------|
| 2 | [2] | [] | 숫자 출력 |
| + | [2] | [+] | 스택 비어있음, push |
| 3 | [2,3] | [+] | 숫자 출력 |
| * | [2,3] | [+,*] | precedence(+)<precedence(*), push |
| 4 | [2,3,4] | [+,*] | 숫자 출력 |
| (끝) | [2,3,4,*,+] | [] | 스택 비우기 |

**결과: `2 3 4 * +`** ✅

**계산:**
```
2 3 4 * +
→ 3*4 = 12
→ 2+12 = 14
```

---

### 예제 2: `(3 + 2) * 4 - 1`

| 토큰 | postfix | stack | 설명 |
|------|---------|-------|------|
| ( | [] | [(] | 여는 괄호 push |
| 3 | [3] | [(] | 숫자 출력 |
| + | [3] | [(,+] | precedence('(')=0 < precedence('+')=1 |
| 2 | [3,2] | [(,+] | 숫자 출력 |
| ) | [3,2,+] | [] | '('까지 pop, '(' 제거 |
| * | [3,2,+] | [*] | 스택 비어있음, push |
| 4 | [3,2,+,4] | [*] | 숫자 출력 |
| - | [3,2,+,4,*] | [-] | precedence(*)>=precedence(-), * 출력 |
| 1 | [3,2,+,4,*,1] | [-] | 숫자 출력 |
| (끝) | [3,2,+,4,*,1,-] | [] | 스택 비우기 |

**결과: `3 2 + 4 * 1 -`** ✅

**계산:**
```
3 2 + 4 * 1 -
→ 3+2 = 5
→ 5*4 = 20
→ 20-1 = 19
```

---

### 예제 3: `3 + 4 * 2 - 1`

| 토큰 | postfix | stack | 설명 |
|------|---------|-------|------|
| 3 | [3] | [] | 숫자 출력 |
| + | [3] | [+] | 스택 비어있음, push |
| 4 | [3,4] | [+] | 숫자 출력 |
| * | [3,4] | [+,*] | precedence(+)<precedence(*) |
| 2 | [3,4,2] | [+,*] | 숫자 출력 |
| - | [3,4,2,*] | [+] | * 출력 (2>=1) |
|   | [3,4,2,*,+] | [] | + 출력 (1>=1) |
|   | [3,4,2,*,+] | [-] | - push |
| 1 | [3,4,2,*,+,1] | [-] | 숫자 출력 |
| (끝) | [3,4,2,*,+,1,-] | [] | 스택 비우기 |

**결과: `3 4 2 * + 1 -`** ✅

---

## 🎓 시험 대비 암기 포인트

### 3줄 요약
```
1. 숫자는 바로 출력
2. 연산자는 우선순위 비교 후 처리
3. 괄호는 특별 처리
```

### 연산자 처리 암기법
```
"스택 맨 위가 나보다 우선순위 높거나 같으면,
 그놈을 먼저 출력하고,
 나를 스택에 넣는다"
```

### 괄호 처리 암기법
```
여는 괄호 '(': 무조건 push
닫는 괄호 ')': '('를 만날 때까지 pop & 출력
```

---

## ⚠️ 자주 하는 실수

### 실수 1: 연산자 비교 조건
```python
# ❌ 틀림
while precedence(s[-1]) > precedence(ch):

# ✅ 맞음
while precedence(s[-1]) >= precedence(ch):
# 같은 우선순위도 왼쪽부터 계산!
```

### 실수 2: 스택 체크 누락
```python
# ❌ 틀림 (IndexError 발생 가능)
while precedence(s[-1]) >= precedence(ch):

# ✅ 맞음
while len(s) and precedence(s[-1]) >= precedence(ch):
```

### 실수 3: 괄호 제거 누락
```python
# ❌ 틀림 (괄호가 출력됨)
elif ch == ')':
    while s[-1] != '(':
        postfix.append(s[-1])
        s.pop()
    # '(' 제거 안 함!

# ✅ 맞음
elif ch == ')':
    while s[-1] != '(':
        postfix.append(s[-1])
        s.pop()
    s.pop()  # '(' 제거!
```

---

## 🔥 시험 직전 체크리스트

### 손으로 변환 (5분)
- [ ] `2 + 3 * 4` → `2 3 4 * +`
- [ ] `(2 + 3) * 4` → `2 3 + 4 *`
- [ ] `2 * 3 + 4` → `2 3 * 4 +`

### 코드 구현 (10분)
- [ ] precedence 함수
- [ ] isOperator 함수
- [ ] InfixToPostfix 핵심 로직 (특히 연산자 처리 부분)

### 개념 설명 (3분)
- [ ] 후위 표기법의 장점
- [ ] 연산자 우선순위 규칙
- [ ] 괄호 처리 방법

---

## 💡 추가 연습 문제

직접 변환해보세요!

1. `5 + 3 * 2 - 4` → ?
2. `(5 + 3) * (2 - 4)` → ?
3. `8 / 2 + 3 * 4 - 1` → ?

<details>
<summary>정답 보기</summary>

1. `5 3 2 * + 4 -` (결과: 7)
2. `5 3 + 2 4 - *` (결과: -16)
3. `8 2 / 3 4 * + 1 -` (결과: 15)

</details>

---

## 🎯 최종 정리

**이것만 기억하세요:**

1. **숫자** → 바로 출력
2. **'('** → push
3. **')'** → '('까지 pop
4. **연산자** → 우선순위 비교 (핵심!)
   ```python
   while len(s) and precedence(s[-1]) >= precedence(ch):
       출력
   push
   ```
5. **끝** → 스택 비우기

**후위 표기법은 스택의 꽃입니다!** 🌸

완벽하게 이해하고 손으로 3번만 써보면 시험 만점! 💯

---

*작성일: 2025년 10월 31일*
*복습 필수! 시험 전날 꼭 다시 보기!* 🔖